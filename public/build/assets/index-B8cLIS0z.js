const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/hashMessage-Cv6eLlmk.js","assets/app-u8HtU4Dn.js","assets/checkContractWalletSignature-C8vJCAZx.js","assets/isValidSignature-BFAL530A.js","assets/checkContractWalletSignedTypedData-BPPJFbfh.js","assets/send-eip712-transaction-BSjQkEfC.js","assets/eth_sendRawTransaction-DPdnXbFR.js","assets/concat-hex-aYp195_m.js","assets/sha256-BF0m8Wt-.js"])))=>i.map(i=>d[i]);
import{B as At,K as Q,L as Gt,M as vt,O as D,P as bt,Q as z,R as tt,S as b,T as et,V as M,W as q,X as wt,Y as nt,Z as at,$ as st,a0 as Ot,a1 as Pt,a2 as S,a3 as Tt,l as xt,v as Lt,a4 as L,a5 as O,a6 as _t,a7 as E,a8 as Dt,a9 as Et,aa as w,ab as V,ac as $,g as rt,ad as Vt,ae as G,af as Ct,ag as Ut,s as it,ah as H,ai as T,aj as It,ak as B,al as St,am as Z,an as Ft,ao as ot,ap as x,aq as Nt,ar as Rt,as as Mt,b as $t,_ as v,p as ct,at as Ht,au as Bt,d as kt}from"./app-u8HtU4Dn.js";import{m as jt,p as Wt,s as zt}from"./send-eip712-transaction-BSjQkEfC.js";import{concatHex as qt}from"./concat-hex-aYp195_m.js";class Zt extends At{constructor(e){super(`Filter type "${e}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const k=Q;function dt(t){const{abi:e,args:n=[],name:a}=t,i=Gt(a,{strict:!1}),s=e.filter(r=>i?r.type==="function"?vt(r)===a:r.type==="event"?k(r)===a:!1:"name"in r&&r.name===a);if(s.length===0)return;if(s.length===1)return s[0];let o;for(const r of s){if(!("inputs"in r))continue;if(!n||n.length===0){if(!r.inputs||r.inputs.length===0)return r;continue}if(!r.inputs||r.inputs.length===0||r.inputs.length!==n.length)continue;if(n.every((d,u)=>{const f="inputs"in r&&r.inputs[u];return f?F(d,f):!1})){if(o&&"inputs"in o&&o.inputs){const d=ut(r.inputs,o.inputs,n);if(d)throw new bt({abiItem:r,type:d[0]},{abiItem:o,type:d[1]})}o=r}}return o||s[0]}function F(t,e){const n=typeof t,a=e.type;switch(a){case"address":return D(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return a==="tuple"&&"components"in e?Object.values(e.components).every((i,s)=>F(Object.values(t)[s],i)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(a)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(a)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(a)?Array.isArray(t)&&t.every(i=>F(i,{...e,type:a.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function ut(t,e,n){for(const a in t){const i=t[a],s=e[a];if(i.type==="tuple"&&s.type==="tuple"&&"components"in i&&"components"in s)return ut(i.components,s.components,n[a]);const o=[i.type,s.type];if(o.includes("address")&&o.includes("bytes20")?!0:o.includes("address")&&o.includes("string")?D(n[a],{strict:!1}):o.includes("address")&&o.includes("bytes")?D(n[a],{strict:!1}):!1)return o}}const Y="/docs/contract/encodeEventTopics";function Yt(t){var c;const{abi:e,eventName:n,args:a}=t;let i=e[0];if(n){const d=dt({abi:e,name:n});if(!d)throw new z(n,{docsPath:Y});i=d}if(i.type!=="event")throw new z(void 0,{docsPath:Y});const s=tt(i),o=k(s);let r=[];if(a&&"inputs"in i){const d=(c=i.inputs)==null?void 0:c.filter(f=>"indexed"in f&&f.indexed),u=Array.isArray(a)?a:Object.values(a).length>0?(d==null?void 0:d.map(f=>a[f.name]))??[]:[];u.length>0&&(r=(d==null?void 0:d.map((f,l)=>Array.isArray(u[l])?u[l].map((y,g)=>K({param:f,value:u[l][g]})):u[l]?K({param:f,value:u[l]}):null))??[])}return[o,...r]}function K({param:t,value:e}){if(t.type==="string"||t.type==="bytes")return b(et(e));if(t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/))throw new Zt(t.type);return M([t],[e])}function Kt(t,e){if(!D(t,{strict:!1}))throw new q({address:t});if(!D(e,{strict:!1}))throw new q({address:e});return t.toLowerCase()===e.toLowerCase()}const X="/docs/contract/decodeEventLog";function Xt(t){const{abi:e,data:n,strict:a,topics:i}=t,s=a??!0,[o,...r]=i;if(!o)throw new wt({docsPath:X});const c=e.find(p=>p.type==="event"&&o===k(tt(p)));if(!(c&&"name"in c)||c.type!=="event")throw new nt(o,{docsPath:X});const{name:d,inputs:u}=c,f=u==null?void 0:u.some(p=>!("name"in p&&p.name));let l=f?[]:{};const y=u.filter(p=>"indexed"in p&&p.indexed);for(let p=0;p<y.length;p++){const m=y[p],h=r[p];if(!h)throw new at({abiItem:c,param:m});l[f?p:m.name||p]=Jt({param:m,value:h})}const g=u.filter(p=>!("indexed"in p&&p.indexed));if(g.length>0){if(n&&n!=="0x")try{const p=st(g,n);if(p)if(f)l=[...l,...p];else for(let m=0;m<g.length;m++)l[g[m].name]=p[m]}catch(p){if(s)throw p instanceof Ot||p instanceof Pt?new S({abiItem:c,data:n,params:g,size:Tt(n)}):p}else if(s)throw new S({abiItem:c,data:"0x",params:g,size:0})}return{eventName:d,args:Object.values(l).length>0?l:void 0}}function Jt({param:t,value:e}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?e:(st([t],e)||[])[0]}function Qt(t){const{abi:e,args:n,logs:a,strict:i=!0}=t,s=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})();return a.map(o=>{var r;try{const c=dt({abi:e,name:o.topics[0]});if(!c)return null;const d=Xt({...o,abi:[c],strict:i});return s&&!s.includes(d.eventName)||!te({args:d.args,inputs:c.inputs,matchArgs:n})?null:{...d,...o}}catch(c){let d,u;if(c instanceof nt)return null;if(c instanceof S||c instanceof at){if(i)return null;d=c.abiItem.name,u=(r=c.abiItem.inputs)==null?void 0:r.some(f=>!("name"in f&&f.name))}return{...o,args:u?[]:{},eventName:d}}}).filter(Boolean)}function te(t){const{args:e,inputs:n,matchArgs:a}=t;if(!a)return!0;if(!e)return!1;function i(s,o,r){try{return s.type==="address"?Kt(o,r):s.type==="string"||s.type==="bytes"?b(et(o))===r:o===r}catch{return!1}}return Array.isArray(e)&&Array.isArray(a)?a.every((s,o)=>{if(!s)return!0;const r=n[o];return r?(Array.isArray(s)?s:[s]).some(d=>i(r,d,e[o])):!1}):typeof e=="object"&&!Array.isArray(e)&&typeof a=="object"&&!Array.isArray(a)?Object.entries(a).every(([s,o])=>{if(!o)return!0;const r=n.find(d=>d.name===s);return r?(Array.isArray(o)?o:[o]).some(d=>i(r,d,e[s])):!1}):!1}function ee(t){const{domain:e={},message:n,primaryType:a}=t,i={EIP712Domain:xt({domain:e}),...t.types};Lt({domain:e,message:n,primaryType:a,types:i});const s=["0x1901"];return e&&s.push(ne({domain:e,types:i})),a!=="EIP712Domain"&&s.push(pt({data:n,primaryType:a,types:i})),b(L(s))}function ne({domain:t,types:e}){return pt({data:t,primaryType:"EIP712Domain",types:e})}function pt({data:t,primaryType:e,types:n}){const a=mt({data:t,primaryType:e,types:n});return b(a)}function mt({data:t,primaryType:e,types:n}){const a=[{type:"bytes32"}],i=[ae({primaryType:e,types:n})];for(const s of n[e]){const[o,r]=yt({types:n,name:s.name,type:s.type,value:t[s.name]});a.push(o),i.push(r)}return M(a,i)}function ae({primaryType:t,types:e}){const n=O(se({primaryType:t,types:e}));return b(n)}function se({primaryType:t,types:e}){let n="";const a=lt({primaryType:t,types:e});a.delete(t);const i=[t,...Array.from(a).sort()];for(const s of i)n+=`${s}(${e[s].map(({name:o,type:r})=>`${r} ${o}`).join(",")})`;return n}function lt({primaryType:t,types:e},n=new Set){const a=t.match(/^\w*/u),i=a==null?void 0:a[0];if(n.has(i)||e[i]===void 0)return n;n.add(i);for(const s of e[i])lt({primaryType:s.type,types:e},n);return n}function yt({types:t,name:e,type:n,value:a}){if(t[n]!==void 0)return[{type:"bytes32"},b(mt({data:a,primaryType:n,types:t}))];if(n==="bytes")return a=`0x${(a.length%2?"0":"")+a.slice(2)}`,[{type:"bytes32"},b(a)];if(n==="string")return[{type:"bytes32"},b(O(a))];if(n.lastIndexOf("]")===n.length-1){const i=n.slice(0,n.lastIndexOf("[")),s=a.map(o=>yt({name:e,type:i,types:t,value:o}));return[{type:"bytes32"},b(M(s.map(([o])=>o),s.map(([,o])=>o)))]}return[{type:n},a]}function re(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="event")}function ft(t){const{signature:e}=t;let n;return re(e)?n=e:n=_t(e),{abiEvent:n,hash:Q(n),topics:Yt({abi:[n],args:t.filters})}}function ie(t){const{logs:e,events:n,strict:a}=t;return Qt({logs:e,abi:n.map(i=>i.abiEvent),strict:a})}const oe="0xdd62ed3e",ce=[{type:"address",name:"owner"},{type:"address",name:"spender"}],de=[{type:"uint256"}];async function ue(t){return E({contract:t.contract,method:[oe,ce,de],params:[t.owner,t.spender]})}function pe(t){return t.id===324||t.id===300||t.id===302||t.id===11124}function me(t={}){return ft({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function le(t={}){return ft({signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function ye(t){const{receipt:e}=t,n={...e,transactionHash:e.transactionHash,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs,to:e.to?e.to:null,transactionIndex:e.transactionIndex,status:e.status,type:e.type};return e.blobGasPrice&&(n.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(n.blobGasUsed=BigInt(e.blobGasUsed)),{...t,receipt:n,userOpHash:t.userOpHash,actualGasCost:BigInt(t.actualGasCost),actualGasUsed:BigInt(t.actualGasUsed),nonce:BigInt(t.nonce)}}const fe=()=>{const t=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),i=BigInt(Math.floor(Math.random()*4294967296)),s=BigInt(Math.floor(Math.random()*4294967296));return t<<BigInt(160)|e<<BigInt(128)|n<<BigInt(96)|a<<BigInt(64)|i<<BigInt(32)|s};function j(t){return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,n==null||Dt(n)?n:Et(n)]))}async function he(t){return _({...t,operation:"eth_sendUserOperation",params:[j(t.userOp),t.options.entrypointAddress??w]})}async function C(t){const e=await _({...t,operation:"eth_estimateUserOperationGas",params:[j(t.userOp),t.options.entrypointAddress??w]});return{preVerificationGas:G(e.preVerificationGas),verificationGas:G(e.verificationGas),verificationGasLimit:G(e.verificationGasLimit),callGasLimit:G(e.callGasLimit)+Ct,paymasterVerificationGasLimit:e.paymasterVerificationGasLimit!==void 0?G(e.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:e.paymasterPostOpGasLimit!==void 0?G(e.paymasterPostOpGasLimit):void 0}}async function ge(t){const e=await _({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:G(e.maxPriorityFeePerGas),maxFeePerGas:G(e.maxFeePerGas)}}async function Ae(t){var n,a;const e=await Ge(t);if(e){if(e.success===!1){const s=(a=(n=ie({events:[me(),le()],logs:e.logs})[0])==null?void 0:n.args)==null?void 0:a.revertReason;if(!s)throw new Error(`UserOp failed at txHash: ${e.receipt.transactionHash}`);const o=Ut({data:s});throw new Error(`UserOp failed with reason: '${o.args.join(",")}' at txHash: ${e.receipt.transactionHash}`)}return e.receipt}}async function Ge(t){const e=await _({options:t,operation:"eth_getUserOperationReceipt",params:[t.userOpHash]});if(e)return ye(e)}async function ve(t){const e=await _({options:t.options,operation:"zk_paymasterData",params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}async function be(t){return{transactionHash:(await _({options:t.options,operation:"zk_broadcastTransaction",params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}async function _(t){const{options:e,operation:n,params:a}=t,s=V(e.entrypointAddress||w)==="v0.6"?"v1":"v2",o=e.bundlerUrl??$(e.chain,s),c=await rt(e.client)(o,{method:"POST",headers:{"Content-Type":"application/json"},body:Vt({jsonrpc:"2.0",id:1,method:n,params:a})}),d=await c.json();if(!c.ok||d.error){let u=d.error||c.statusText;typeof u=="object"&&(u=JSON.stringify(u));const f=d.code||"UNKNOWN";throw new Error(`${n} error: ${u}
Status: ${c.status}
Code: ${f}`)}return d.result}async function we(t){const{factoryContract:e,predictAddressOverride:n,adminAddress:a,accountSalt:i,accountAddress:s}=t;if(n)return n(e);if(s)return s;if(!a)throw new Error("Account address is required to predict the smart wallet address.");const o=it(i??"");return E({contract:e,method:"function getAddress(address, bytes) returns (address)",params:[a,o]})}function ht(t){const{adminAddress:e,factoryContract:n,createAccountOverride:a,accountSalt:i}=t;return a?a(n):H({contract:n,method:"function createAccount(address, bytes) returns (address)",params:[e,it(i??"")]})}function gt(t){const{accountContract:e,transaction:n,executeOverride:a}=t;return a?a(e,n):H({contract:e,method:"function execute(address, uint256, bytes)",params:[n.to||"",n.value||0n,n.data||"0x"]})}function Oe(t){const{accountContract:e,transactions:n,executeBatchOverride:a}=t;return a?a(e,n):H({contract:e,method:"function executeBatch(address[], uint256[], bytes[])",params:[n.map(i=>i.to||""),n.map(i=>i.value||0n),n.map(i=>i.data||"0x")]})}const Pe="0x35567e1a",Te=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],xe=[{type:"uint256",name:"nonce"}];async function Le(t){return E({contract:t.contract,method:[Pe,Te,xe],params:[t.sender,t.key]})}const _e="0xa6193531",De=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],Ee=[{type:"bytes32"}];async function Ve(t){return E({contract:t.contract,method:[_e,De,Ee],params:[t.userOp]})}const Ce="0x22cdde4c",Ue=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],Ie=[{type:"bytes32"}];async function Se(t){return E({contract:t.contract,method:[Ce,Ue,Ie],params:[t.userOp]})}function Fe(t){return t.factory?L([t.factory,t.factoryData||"0x"]):"0x"}function Ne(t){return L([T(O(t.verificationGasLimit),{size:16}),T(O(t.callGasLimit),{size:16})])}function Re(t){return L([T(O(t.maxPriorityFeePerGas),{size:16}),T(O(t.maxFeePerGas),{size:16})])}function Me(t){return t.paymaster?L([t.paymaster,T(O(t.paymasterVerificationGasLimit||BigInt(0)),{size:16}),T(O(t.paymasterPostOpGasLimit||BigInt(0)),{size:16}),t.paymasterData||"0x"]):"0x"}const $e=t=>({sender:t.sender,nonce:t.nonce,initCode:Fe(t),callData:t.callData,accountGasLimits:Ne(t),preVerificationGas:t.preVerificationGas,gasFees:Re(t),paymasterAndData:Me(t),signature:t.signature});async function U(t){var p;const{userOp:e,paymasterOverride:n,client:a,chain:i,entrypointAddress:s}=t;if(n)return n(e);const o={"Content-Type":"application/json"},r=s??w,d=V(r)==="v0.6"?"v1":"v2",u=$(i,d),l=await rt(a)(u,{method:"POST",headers:o,body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[j(e),r]})}),y=await l.json();if(!l.ok){const m=y.error||l.statusText,h=y.code||"UNKNOWN";throw new Error(`Paymaster error: ${m}
Status: ${l.status}
Code: ${h}`)}if(y.result)return typeof y.result=="string"?{paymasterAndData:y.result}:{paymasterAndData:y.result.paymasterAndData,verificationGasLimit:y.result.verificationGasLimit?G(y.result.verificationGasLimit):void 0,preVerificationGas:y.result.preVerificationGas?G(y.result.preVerificationGas):void 0,callGasLimit:y.result.callGasLimit?G(y.result.callGasLimit):void 0,paymaster:y.result.paymaster,paymasterData:y.result.paymasterData,paymasterVerificationGasLimit:y.result.paymasterVerificationGasLimit?G(y.result.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:y.result.paymasterPostOpGasLimit?G(y.result.paymasterPostOpGasLimit):void 0};const g=((p=y.error)==null?void 0:p.message)||y.error||l.statusText||"unknown error";throw new Error(`Paymaster error from ${u}: ${g}`)}async function He(t){const e=t.timeoutMs||12e4,n=t.intervalMs||1e3,a=Date.now()+e;for(;Date.now()<a;){const i=await Ae(t);if(i)return i;await new Promise(s=>setTimeout(s,n))}throw new Error("Timeout waiting for userOp to be mined")}async function Be(t){var h;const{transaction:e,accountContract:n,factoryContract:a,adminAddress:i,overrides:s,sponsorGas:o}=t,r=e.chain,c=e.client,d={client:c,chain:r,entrypointAddress:s==null?void 0:s.entrypointAddress},u=V(((h=t.overrides)==null?void 0:h.entrypointAddress)||w),[f,l,y,g]=await Promise.all([It(n),B(e),ke({executeTx:e,bundlerOptions:d,chain:r,client:c}),Ze({accountContract:n,chain:r,client:c,entrypointAddress:s==null?void 0:s.entrypointAddress,getNonceOverride:s==null?void 0:s.getAccountNonce})]),{maxFeePerGas:p,maxPriorityFeePerGas:m}=y;return u==="v0.7"?je({bundlerOptions:d,factoryContract:a,accountContract:n,adminAddress:i,sponsorGas:o,overrides:s,isDeployed:f,nonce:g,callData:l,maxFeePerGas:p,maxPriorityFeePerGas:m}):We({bundlerOptions:d,factoryContract:a,accountContract:n,adminAddress:i,sponsorGas:o,overrides:s,isDeployed:f,nonce:g,callData:l,maxFeePerGas:p,maxPriorityFeePerGas:m})}async function ke(t){const{executeTx:e,bundlerOptions:n,chain:a,client:i}=t;let{maxFeePerGas:s,maxPriorityFeePerGas:o}=e;const c=V(n.entrypointAddress||w)==="v0.6"?"v1":"v2",d=(n==null?void 0:n.bundlerUrl)??$(a,c);if(St(d)){const u=await ge({options:n});s=u.maxFeePerGas,o=u.maxPriorityFeePerGas}else{const[u,f]=await Promise.all([Z(s),Z(o)]);if(u&&f)s=u,o=f;else{const l=await Ft(i,a);o=f??l.maxPriorityFeePerGas??0n,s=u??l.maxFeePerGas??0n}}return{maxFeePerGas:s,maxPriorityFeePerGas:o}}async function je(t){const{bundlerOptions:e,isDeployed:n,factoryContract:a,accountContract:i,adminAddress:s,sponsorGas:o,overrides:r,nonce:c,callData:d,maxFeePerGas:u,maxPriorityFeePerGas:f}=t,{chain:l,client:y}=e,g=n?void 0:a.address,p=n?"0x":await B(ht({factoryContract:a,adminAddress:s,accountSalt:r==null?void 0:r.accountSalt,createAccountOverride:r==null?void 0:r.createAccount})),m={sender:i.address,nonce:c,callData:d,maxFeePerGas:u,maxPriorityFeePerGas:f,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,factory:g,factoryData:p,paymaster:void 0,paymasterData:"0x",paymasterVerificationGasLimit:0n,paymasterPostOpGasLimit:0n,signature:ot};if(o){const h=await U({userOp:m,chain:l,client:y,entrypointAddress:r==null?void 0:r.entrypointAddress,paymasterOverride:r==null?void 0:r.paymaster});if(h.paymaster&&h.paymasterData&&(m.paymaster=h.paymaster,m.paymasterData=h.paymasterData),h.callGasLimit&&h.verificationGasLimit&&h.preVerificationGas&&h.paymasterPostOpGasLimit&&h.paymasterVerificationGasLimit)m.callGasLimit=h.callGasLimit,m.verificationGasLimit=h.verificationGasLimit,m.preVerificationGas=h.preVerificationGas,m.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit,m.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit;else{const A=await C({userOp:m,options:e});m.callGasLimit=A.callGasLimit,m.verificationGasLimit=A.verificationGasLimit,m.preVerificationGas=A.preVerificationGas,m.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit||0n,m.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit||0n;const P=await U({userOp:m,chain:l,client:y,entrypointAddress:r==null?void 0:r.entrypointAddress,paymasterOverride:r==null?void 0:r.paymaster});P.paymaster&&P.paymasterData&&(m.paymaster=P.paymaster,m.paymasterData=P.paymasterData)}}else{const h=await C({userOp:m,options:e});m.callGasLimit=h.callGasLimit,m.verificationGasLimit=h.verificationGasLimit,m.preVerificationGas=h.preVerificationGas,m.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit||0n,m.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit||0n}return{...m,signature:"0x"}}async function We(t){const{bundlerOptions:e,isDeployed:n,factoryContract:a,accountContract:i,adminAddress:s,sponsorGas:o,overrides:r,nonce:c,callData:d,maxFeePerGas:u,maxPriorityFeePerGas:f}=t,{chain:l,client:y}=e,g=n?"0x":await qe({factoryContract:a,adminAddress:s,accountSalt:r==null?void 0:r.accountSalt,createAccountOverride:r==null?void 0:r.createAccount}),p={sender:i.address,nonce:c,initCode:g,callData:d,maxFeePerGas:u,maxPriorityFeePerGas:f,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:ot};if(o){const m=await U({userOp:p,chain:l,client:y,entrypointAddress:r==null?void 0:r.entrypointAddress,paymasterOverride:r==null?void 0:r.paymaster}),h="paymasterAndData"in m?m.paymasterAndData:"0x";if(h&&h!=="0x"&&(p.paymasterAndData=h),m.callGasLimit&&m.verificationGasLimit&&m.preVerificationGas)p.callGasLimit=m.callGasLimit,p.verificationGasLimit=m.verificationGasLimit,p.preVerificationGas=m.preVerificationGas;else{const A=await C({userOp:p,options:e});if(p.callGasLimit=A.callGasLimit,p.verificationGasLimit=A.verificationGasLimit,p.preVerificationGas=A.preVerificationGas,h&&h!=="0x"){const P=await U({userOp:p,chain:l,client:y,entrypointAddress:r==null?void 0:r.entrypointAddress,paymasterOverride:r==null?void 0:r.paymaster}),I="paymasterAndData"in P?P.paymasterAndData:"0x";I&&I!=="0x"&&(p.paymasterAndData=I)}}}else{const m=await C({userOp:p,options:e});p.callGasLimit=m.callGasLimit,p.verificationGasLimit=m.verificationGasLimit,p.preVerificationGas=m.preVerificationGas}return{...p,signature:"0x"}}async function ze(t){const{userOp:e,chain:n,entrypointAddress:a,adminAccount:i}=t,s=V(a||w);let o;if(s==="v0.7"){const r=$e(e);o=await Se({contract:x({address:a||Nt,chain:n,client:t.client}),userOp:r})}else o=await Ve({contract:x({address:a||w,chain:n,client:t.client}),userOp:e});if(i.signMessage){const r=await i.signMessage({message:{raw:Rt(o)}});return{...e,signature:r}}throw new Error("signMessage not implemented in signingAccount")}async function qe(t){const{factoryContract:e,adminAddress:n,accountSalt:a,createAccountOverride:i}=t,s=ht({factoryContract:e,adminAddress:n,accountSalt:a,createAccountOverride:i});return L([e.address,await B(s)])}async function Ze(t){const{accountContract:e,chain:n,client:a,entrypointAddress:i,getNonceOverride:s}=t;return s?s(e):Le({contract:x({address:i||w,chain:n,client:a}),key:fe(),sender:e.address})}function Ye(t){return t.id==="smart"}const W=new WeakMap,N=new WeakMap;async function Ke(t,e,n){var g,p,m,h;const{personalAccount:a,client:i,chain:s}=e;if(!a)throw new Error("Personal wallet does not have an account");const o=n,r=o.factoryAddress??Mt((g=n.overrides)==null?void 0:g.entrypointAddress),c=s??o.chain,d="gasless"in o?o.gasless:o.sponsorGas;if(pe(c))return[tn({creationOptions:n,connectionOptions:e,chain:c,sponsorGas:d}),c];const u=x({client:i,address:r,chain:c}),f=await we({factoryContract:u,adminAddress:a.address,predictAddressOverride:(p=o.overrides)==null?void 0:p.predictAddress,accountSalt:(m=o.overrides)==null?void 0:m.accountSalt,accountAddress:(h=o.overrides)==null?void 0:h.accountAddress}).then(A=>A).catch(A=>{throw new Error(`Failed to get account address with factory contract ${u.address} on chain ID ${c.id}: ${(A==null?void 0:A.message)||"unknown error"}`,{cause:A})}),l=x({client:i,address:f,chain:c}),y=await Je({...o,chain:c,sponsorGas:d,personalAccount:a,accountContract:l,factoryContract:u,client:i});return W.set(a,t),N.set(t,a),[y,c]}async function Xe(t){const e=N.get(t);e&&(W.delete(e),N.delete(t))}async function Je(t){const{accountContract:e}=t,n={address:$t(e.address),async sendTransaction(a){var r,c,d;const i=(r=t.overrides)==null?void 0:r.erc20Paymaster;let s;if(i){await Qe({accountContract:e,erc20Paymaster:i,options:t});const u=async()=>({paymasterAndData:qt([i.address,i==null?void 0:i.token]),paymaster:i.address,paymasterData:"0x"});s=((c=t.overrides)==null?void 0:c.paymaster)||u}const o=gt({accountContract:e,transaction:a,executeOverride:(d=t.overrides)==null?void 0:d.execute});return R({executeTx:o,options:{...t,overrides:{...t.overrides,paymaster:s}}})},async sendBatchTransaction(a){var s;const i=Oe({accountContract:e,transactions:a,executeBatchOverride:(s=t.overrides)==null?void 0:s.executeBatch});return R({executeTx:i,options:t})},async signMessage({message:a}){const[{isContractDeployed:i},{readContract:s},{encodeAbiParameters:o},{hashMessage:r},{checkContractWalletSignature:c}]=await Promise.all([v(()=>import("./app-u8HtU4Dn.js").then(g=>g.dZ),[]),v(()=>import("./app-u8HtU4Dn.js").then(g=>g.dX),[]),v(()=>import("./app-u8HtU4Dn.js").then(g=>g.dW),[]),v(()=>import("./hashMessage-Cv6eLlmk.js"),__vite__mapDeps([0,1])),v(()=>import("./checkContractWalletSignature-C8vJCAZx.js"),__vite__mapDeps([2,3,1]))]);await i(e)||await J({options:t,account:n,accountContract:e});const u=r(a);let f=!1;try{await s({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[u]}),f=!0}catch{}let l;if(f){const g=o([{type:"bytes32"}],[u]);l=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:g}})}else l=await t.personalAccount.signMessage({message:a});if(await c({contract:e,message:a,signature:l}))return l;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(a){var p,m,h;const i=ct(a),[{isContractDeployed:s},{readContract:o},{encodeAbiParameters:r},{checkContractWalletSignedTypedData:c}]=await Promise.all([v(()=>import("./app-u8HtU4Dn.js").then(A=>A.dZ),[]),v(()=>import("./app-u8HtU4Dn.js").then(A=>A.dX),[]),v(()=>import("./app-u8HtU4Dn.js").then(A=>A.dW),[]),v(()=>import("./checkContractWalletSignedTypedData-BPPJFbfh.js"),__vite__mapDeps([4,3,1,5,6,7,8]))]);if(((m=(p=i.domain)==null?void 0:p.verifyingContract)==null?void 0:m.toLowerCase())===((h=e.address)==null?void 0:h.toLowerCase()))return t.personalAccount.signTypedData(i);await s(e)||await J({options:t,account:n,accountContract:e});const f=ee(i);let l=!1;try{await o({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[f]}),l=!0}catch{}let y;if(l){const A=r([{type:"bytes32"}],[f]);y=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:A}})}else y=await t.personalAccount.signTypedData(i);if(await c({contract:e,data:i,signature:y}))return y;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async onTransactionRequested(a){var i,s;return(s=(i=t.personalAccount).onTransactionRequested)==null?void 0:s.call(i,a)}};return n}async function Qe(t){var u;const{accountContract:e,erc20Paymaster:n,options:a}=t,i=n.token,s=x({address:i,chain:e.chain,client:e.client});if(await ue({contract:s,owner:e.address,spender:n.address})>0n)return;const r=Ht({contract:s,spender:n.address,amountWei:jt-1n}),c=await Bt({transaction:r,from:e.address}),d=gt({accountContract:e,transaction:c,executeOverride:(u=a.overrides)==null?void 0:u.execute});await R({executeTx:d,options:{...a,overrides:{...a.overrides,erc20Paymaster:void 0}}})}function tn(t){const{creationOptions:e,connectionOptions:n,chain:a}=t,i={address:n.personalAccount.address,async sendTransaction(s){var u,f,l,y;const o={data:s.data,to:s.to??void 0,value:s.value??0n,chain:kt(s.chainId),client:n.client};let r=await Wt({account:i,transaction:o});if(t.sponsorGas){const g=await ve({options:{client:n.client,chain:a,bundlerUrl:(u=e.overrides)==null?void 0:u.bundlerUrl,entrypointAddress:(f=e.overrides)==null?void 0:f.entrypointAddress},transaction:r});r={...r,...g}}const c=await zt({account:i,chainId:a.id,eip712Transaction:r});return{transactionHash:(await be({options:{client:n.client,chain:a,bundlerUrl:(l=e.overrides)==null?void 0:l.bundlerUrl,entrypointAddress:(y=e.overrides)==null?void 0:y.entrypointAddress},transaction:r,signedTransaction:c})).transactionHash,client:n.client,chain:a}},async signMessage({message:s}){return n.personalAccount.signMessage({message:s})},async signTypedData(s){const o=ct(s);return n.personalAccount.signTypedData(o)},async onTransactionRequested(s){var o,r;return(r=(o=n.personalAccount).onTransactionRequested)==null?void 0:r.call(o,s)}};return i}async function J(t){const{options:e,account:n,accountContract:a}=t,[{sendTransaction:i},{prepareTransaction:s}]=await Promise.all([v(()=>import("./app-u8HtU4Dn.js").then(c=>c.dY),[]),v(()=>import("./app-u8HtU4Dn.js").then(c=>c.dV),[])]),o=s({client:e.client,chain:e.chain,to:a.address,value:0n,gas:50000n});return await i({transaction:o,account:n})}async function R(t){var c,d,u;const{executeTx:e,options:n}=t,a=await Be({transaction:e,factoryContract:n.factoryContract,accountContract:n.accountContract,adminAddress:n.personalAccount.address,sponsorGas:n.sponsorGas,overrides:n.overrides}),i=await ze({client:n.client,chain:n.chain,adminAccount:n.personalAccount,entrypointAddress:(c=n.overrides)==null?void 0:c.entrypointAddress,userOp:a}),s={chain:n.chain,client:n.client,bundlerUrl:(d=n.overrides)==null?void 0:d.bundlerUrl,entrypointAddress:(u=n.overrides)==null?void 0:u.entrypointAddress},o=await he({options:s,userOp:i}),r=await He({...n,userOpHash:o});return{client:n.client,chain:n.chain,transactionHash:r.transactionHash}}const sn=Object.freeze(Object.defineProperty({__proto__:null,connectSmartWallet:Ke,disconnectSmartWallet:Xe,isSmartWallet:Ye,personalAccountToSmartAccountMap:W},Symbol.toStringTag,{value:"Module"}));export{ee as h,sn as i};
